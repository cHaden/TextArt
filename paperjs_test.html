<!DOCTYPE html>
<html>
<head>

    <link href='http://fonts.googleapis.com/css?family=Erica+One|Passion+One:400,900|Playfair+Display+SC:400,900' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Emilys+Candy|Irish+Grover|Vast+Shadow|Monoton|Kranky' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="paperjs_test.css">


    <meta charset="UTF-8">
    <title>Paper JS Test</title>
    <script type="text/javascript" src="./paperjs/dist/paper-full.js"></script>

</head>
<body>
<div class="main">
    <div class="menu">
        <H1>Text Art Generator</H1>

        <!--hacky mcHackerson: trasparent div to make the google fonts load-->
        <div style="color: transparent; height: 1px;">
            <p style="font-family: Erica One">Erica One</p>
            <p style="font-family: Passion One">Passion One</p>
            <p style="font-family: Playfair Display SC">Playfair Display SC</p>

            <p style="font-family: Emilys Candy">Emilys Candy</p>
            <p style="font-family: Irish Grover">Irish Grover</p>
            <p style="font-family: Vast Shadow">Vast Shadow</p>
            <p style="font-family: Monoton">Monoton</p>
            <p style="font-family: Kranky">Kranky</p>
        </div>
        <!-- more hidden divs: make images available to paperjs-->
        <img style="color:transparent; height: 0px" id="linen" src="./linen.png">
        <img style="color:transparent; height: 0px" id="slate" src="./slate.jpg">
        <img style="color:transparent; height: 0px" id="paper" src="./paper.jpg">





        <div class="box">
            Please enter a name:<br>
            <input class="textbox" type="text" name="name" value="Your name here" id="name">
        </div>
        <br><br>

        <div class="box">
            Please select a color palette:<br>
            <input class="radio" type="radio" name="palette" value="0" id="r0">
                <span style="background: #000000; color:#000000">00</span><span style="background: #225378; color:#225378">00</span><span style="background: #1695A3; color:#1695A3">00</span><span style="background: #ACF0F2; color:#ACF0F2">00</span><span style="background: #F3FFE2; color:#F3FFE2">00</span><span style="background: #EB7F00; color:#EB7F00">00</span><br>
            <input class="radio" type="radio" name="palette" value="1" id="r1">
                <span style="background: #FFFFFF; color:#FFFFFF">00</span><span style="background: #7BE3D6; color:#7BE3D6">00</span><span style="background: #755085; color:#755085">00</span><span style="background: #00FFEC; color:#00FFEC">00</span><span style="background: #FFAFDF; color:#FFAFDF">00</span><br>
            <input class="radio" type="radio" name="palette" value="2" id="r2">
                <span style="background: #553344; color:#553344">00</span><span style="background: #553344; color:#553344">00</span><span style="background: #EE8866; color:#EE8866">00</span><span style="background: #DDDDEE; color:#DDDDEE">00</span><span style="background: #AACCDD; color:#AACCDD">00</span><br>
            <input class="radio" type="radio" name="palette" value="3" id="r3">
                <span style="background: #684007; color:#684007">00</span><span style="background: #796002; color:#796002">00</span><span style="background: #430E37; color:#430E37">00</span><span style="background: #6C0B0B; color:#6C0B0B">00</span><span style="background: #042E04; color:#042E04">00</span><br>
            <input class="radio" type="radio" name="palette" value="4" id="r4">
                <span style="background: #E3D6AB; color:#E3D6AB">00</span><span style="background: #778979; color:#778979">00</span><span style="background: #CCDCC1; color:#CCDCC1">00</span><span style="background: #A9916B; color:#A9916B">00</span><span style="background: #D78258; color:#D78258">00</span><br>
            <input class="radio" type="radio" name="palette" value="5" id="r5">
                <span style="background: #493a14; color:#493a14">00</span><span style="background: #a0c8c8; color:#a0c8c8">00</span><span style="background: #dfb500; color:#dfb500">00</span><span style="background: #928a81; color:#928a81">00</span><span style="background: #7c9f2a; color:#7c9f2a">00</span><br>


        </div>
        <br><br>

        <div class="box">
            Please select a font set:<br>
            <input class="radio" type="radio" name="font" value="0" id="f0">
                <span style="font-family: Erica One">Words </span>
                <span style="font-family: Passion One">words </span>
                <span style="font-family: Playfair Display SC">words </span><br>
            <input class="radio" type="radio" name="font" value="1" id="f1">
                <span style="font-family: Emilys Candy">Words </span>
                <span style="font-family: Irish Grover">words </span>
                <span style="font-family: Vast Shadow">words </span>
                <span style="font-family: Monoton">words </span>
                <span style="font-family: Kranky">words </span><br>
        </div>
        <br><br>

        <div class="box">
            <button id="update">Update</button>
            <button id="export">Download as PNG</button>
            <button id="exportSVG">Download as SVG</button>
        </div>
    </div>

    <script type="text/paperscript"  canvas="canvas">

//===============================================


//available color palettes
var palettes = [
    ["#000000","#225378","#1695A3","#ACF0F2","#F3FFE2","#EB7F00"],
    ["#FFFFFF","#7BE3D6","#755085","#00FFEC","#FFAFDF"],
    ["#553344","#997788","#EE8866","#DDDDEE","#AACCDD"],
    ["#684007","#796002","#430E37","#6C0B0B","#042E04"],
    ["#E3D6AB","#778979","#CCDCC1","#A9916B","#D78258"],
    ["#493a14","#a0c8c8","#dfb500","#928a81","#7c9f2a"]];

//which color palette to use for text
var paletteIndex = 0; //make this configurable later

//which color palette to use for background blocks
var blockPaletteIndex = 0; //make this configurable later

//transparency of background blocks
var blockAlpha = 0; 

//available fonts
var fonts = [["Erica One","Passion One","Playfair Display SC"],
    ["Emilys Candy", "Irish Grover", "Vast Shadow", "Monoton", "Kranky"]];

//which font set to use
var fontSet = 1;

//textures available (by id)
var textures = ['', 'linen', 'paper', 'slate'];

//which texture to use
var textureIndex = 0; //make this configurable later

//size of the square in the middle
var startSquare = 100; //make this configurable later

//increase textHeight in the outer boxes
var textIncrease = 1; 
// 1 = no difference 
// >1 = increase in size 
// <1 = decrease in size

//number of blocks (should be a multiple of 4)
var numberOfBlocks = 16; //make this configurable later

//modifier to make sure that the textHeight will fit canvas according to scaling
var scalingModifier = 0;
for( var num=0; num<Math.floor(numberOfBlocks/4); num++){
    scalingModifier += Math.pow(textIncrease,num);
}

//height of each block
var textHeight = Math.floor(((view.bounds.width - startSquare)/2)/scalingModifier);

//set the background color
var background = new Path.Rectangle(view.bounds);
background.fillColor = palettes[paletteIndex][0];

// set the background texture
var raster = new Raster(textures[textureIndex]);
// Move the raster to the center of the view
raster.position = new Point(300,300); //currently hardcoded to assume textures are 600 px and canvas is 600

//currentStartX: current leftmost edge of motif
var currentStartX = (view.bounds.width - startSquare)/2;
//currentStartY: current top edge of motif
var currentStartY = (view.bounds.width - startSquare)/2;

//currentEndX: current right edge of motif
var currentEndX = currentStartX + startSquare;
//currentEndY: current bottom edge of motif
var currentEndY = currentStartX + startSquare;

//text to be displayed
var name =  document.getElementById('name').value; //make this configurable later

//all items in the scene, other than the background
var items = [];

//===============================================

function draw(){

    //clear everything to start drawing again
    for( var key=0; key<items.length; key++){
        items[key].remove();
    }
    items = [];


    //start drawing
    for(var i=1; i <= numberOfBlocks; i++){

        switch(i%4){
        case 1:
            var point = new Point(currentStartX,currentStartY-textHeight);
            var size = new Size(currentEndX - currentStartX, textHeight);
            var rect = new Path.Rectangle(point, size);
            rect.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            rect.fillColor.alpha = blockAlpha;
            items.push(rect);

            var text = new PointText(point);
            text.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            text.fontFamily = fonts[fontSet][Math.floor(Math.random()*fonts[fontSet].length)];
            text.content = name;
            text.fitBounds( rect.bounds );

            //if(i != 1) {
                text.scale( size.width/text.bounds.width, 1);
            //}

            items.push(text);
            currentStartY = currentStartY-textHeight;
            break;

        case 2: 
            var point = new Point(currentEndX,currentStartY);
            var size = new Size(textHeight,currentEndY-currentStartY+textHeight);
            var rect = new Path.Rectangle(point, size);
            rect.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            rect.fillColor.alpha = blockAlpha;
            items.push(rect);

            var text = new PointText(new Point(currentEndX+textHeight,currentStartY));
            text.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            text.fontFamily = fonts[fontSet][Math.floor(Math.random()*fonts[fontSet].length)];
            text.content = name;
            text.rotate(90);
            text.fitBounds( rect.bounds );
            //if(i != 2) {
                text.scale( 1, size.height/text.bounds.height );
            //}

            items.push(text);
            currentEndX = currentEndX+textHeight;
            currentEndY = currentEndY+textHeight;
            break;

        case 3:
            var point = new Point(currentStartX-textHeight,currentEndY-textHeight);
            var size = new Size(currentEndX-currentStartX,textHeight);
            var rect = new Path.Rectangle(point, size);
            rect.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            rect.fillColor.alpha = blockAlpha;
            items.push(rect);

            var text = new PointText(new Point(currentStartX-textHeight+(currentEndX-currentStartX),currentStartY));
            text.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            text.fontFamily = fonts[fontSet][Math.floor(Math.random()*fonts[fontSet].length)];
            text.content = name;
            text.rotate(180);
            text.fitBounds( rect.bounds );
            //if(i != 3) {
                text.scale( size.width/text.bounds.width, 1 );
            //}

            items.push(text);

            currentStartX = currentStartX-textHeight;
            break;

        case 0:
            var point = new Point(currentStartX,currentEndY-textHeight);
            var size = new Size(textHeight,-1*(currentEndY-currentStartY-textHeight));
            var rect = new Path.Rectangle(point, size);
            rect.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            rect.fillColor.alpha = blockAlpha;
            items.push(rect);

            var text = new PointText(new Point(currentEndX,currentStartY));
            text.fillColor = palettes[paletteIndex][Math.floor(Math.random()*(palettes[paletteIndex].length-1))+1];
            text.content = name;
            text.fontFamily = fonts[fontSet][Math.floor(Math.random()*fonts[fontSet].length)];
            text.rotate(270);
            text.translate(0,currentEndY-currentStartY-textHeight);
            text.fitBounds( rect.bounds );
            //if(i != 4) {
                text.scale( 1, (size.height/text.bounds.height)*-1 );
            //}
            items.push(text);

            textHeight = textHeight * textIncrease;
            break;
        }
    }


    //reset vars to starting conditions
    currentStartX = (view.bounds.width - startSquare)/2;
    currentStartY = (view.bounds.width - startSquare)/2;
    currentEndX = currentStartX + startSquare;
    currentEndY = currentStartX + startSquare;
    textHeight = Math.floor(((view.bounds.width - startSquare)/2)/scalingModifier);


}

draw();

var update = document.getElementById('update');
update.onclick = function() {
    name = document.getElementById('name').value;  

    if( document.getElementById('r0').checked) paletteIndex=0;
    else if( document.getElementById('r1').checked) paletteIndex=1;
    else if( document.getElementById('r2').checked) paletteIndex=2;
    else if( document.getElementById('r3').checked) paletteIndex=3;
    else if( document.getElementById('r4').checked) paletteIndex=4;
    else if( document.getElementById('r5').checked) paletteIndex=5;


    if( document.getElementById('f0').checked) fontSet=0;
    else if( document.getElementById('f1').checked) fontSet=1;

    if( document.getElementById('none').checked) textureIndex=document.getElementById('none').value;
    else if( document.getElementById('lin').checked) textureIndex=document.getElementById('lin').value;
    else if(document.getElementById('pap').checked) textureIndex=document.getElementById('pap').value;
    else if(document.getElementById('sla').checked) textureIndex=document.getElementById('sla').value;
    raster.source = textures[ parseInt(textureIndex)];


    if( document.getElementById('increase').checked) textIncrease=document.getElementById('increase').value;
    else if( document.getElementById('decrease').checked) textIncrease=document.getElementById('decrease').value;
    else if(document.getElementById('static').checked) textIncrease=document.getElementById('static').value;

    if( document.getElementById('4blocks').checked) numberOfBlocks=4;
    else if( document.getElementById('8blocks').checked) numberOfBlocks=8;
    else if(document.getElementById('12blocks').checked) numberOfBlocks=12;
    else if(document.getElementById('16blocks').checked) numberOfBlocks=16;

    //update textHeight according to new number of blocks and scaling modifier
    scalingModifier = 0;
    for( var num=0; num<Math.floor(numberOfBlocks/4); num++){
        scalingModifier += Math.pow(textIncrease,num);
    }
    textHeight = Math.floor(((view.bounds.width - startSquare)/2)/scalingModifier);

    background.fillColor = palettes[paletteIndex][0];

    draw();
}


var downloadAsSVG = function (fileName) {

   if(!fileName) {
       fileName = "textArt.svg"
   }

   var url = "data:image/svg+xml;utf8," + encodeURIComponent(paper.project.exportSVG({asString:true}));

   var link = document.createElement("a");
   link.download = fileName;
   link.href = url;
   link.click();
}

var downloadAsPng = function (fileName){
    if(!fileName){
        fileName = "textArt.png";
    }

    var canvas = document.getElementById("canvas");
    var url = canvas.toDataURL("image/png");

    var link = document.createElement("a");
    link.download = fileName;
    link.href = url;
    link.click();
}


//make the download as PNG button work
var exportImage = document.getElementById('export');

exportImage.onclick = function() {
   downloadAsPng();
}

//make the download as SVG button work (experimental)
var exportImageSVG = document.getElementById('exportSVG');

exportImageSVG.onclick = function() {
    downloadAsSVG();
}
//===============================================

</script>  
<div class="canvas"> 
    <canvas id="canvas" height="600" width="600"></canvas>
</div>

<div class="options">
    <h2>More Options!</h2><br><br>

    <div class="box">
        Select a layout<br>
            <input class="radio" type="radio" name="layout" value="log" id="log">
                <span>Log cabin (default)</span><br>        
            <input class="radio" type="radio" name="texture" value="straight" id="straight">
                <span>Straight lines</span><br>
    </div>
    <br><br>

    <div class="box">
        Add a background texture?<br>
        <input class="radio" type="radio" name="texture" value="0" id="none">
                <span>None (default)</span><br>
        <input class="radio" type="radio" name="texture" value="1" id="lin">
                <span>Linen</span><br>
        <input class="radio" type="radio" name="texture" value="2" id="pap">
                <span>Paper</span><br>       
        <input class="radio" type="radio" name="texture" value="3" id="sla">
                <span>Slate</span><br>
    </div>
    <br><br>

    <div class="box">
        Number of blocks<br>
        <input class="radio" type="radio" name="blockNum" value="4" id="4blocks">
                <span>4</span><br>
        <input class="radio" type="radio" name="blockNum" value="8" id="8blocks">
                <span>8</span><br>        
        <input class="radio" type="radio" name="blockNum" value="12" id="12blocks">
                <span>12</span><br>
        <input class="radio" type="radio" name="blockNum" value="16" id="16blocks">
                <span>16 (default)</span><br>
    </div>
    <br><br>

    <div class="box">
        Text height<br>
            <input class="radio" type="radio" name="textheight" value="1.2" id="increase">
                <span>Increases from the center out</span><br>        
            <input class="radio" type="radio" name="textheight" value="0.8" id="decrease">
                <span>Decreases from the center out</span><br>        
            <input class="radio" type="radio" name="textheight" value="1" id="static">
                <span>Remains the same (default)</span><br>
    <div>

</div>


</div>
</body>
</html>
